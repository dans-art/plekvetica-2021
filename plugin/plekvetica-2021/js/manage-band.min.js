let plek_band={default_button_texts:default_button_texts={},construct(){jQuery("#plek-band-form").length>0?empty(jQuery("#band-id").val())?(this.on_band_add(),this.on_edit_band()):this.on_edit_band():jQuery(document).on("click",".plek-follow-band-btn",(function(){plek_band.toggle_follower(this)}))},on_edit_band(){jQuery(document).ready((function(){jQuery("select").select2({theme:"plek"}),plek_band.show_youtube_videos()})),default_button_texts.submit=jQuery("#band-form-submit").text(),jQuery("#plek-band-form button").click((function(e){if(e.preventDefault(),"band-form-cancel"===e.currentTarget.id){if(0===jQuery("#band-form-cancel").closest(".overlay_content").length)window.location=document.referrer;else{let overlay_id=jQuery("#band-form-cancel").closest(".overlay_content").parent().prop("id");overlay_id=overlay_id.replace("_overlay",""),plektemplate.hide_overlay(overlay_id)}return}let is_add_event=!empty(jQuery("#add_event_basic")),is_edit_event=!empty(jQuery("#edit_event_form"));if("band-form-submit"!==e.currentTarget.id||is_edit_event||is_add_event);else{var data=jQuery("#plek-band-form").serialize();plek_band.save_band(data)}})),jQuery(document).on("click",".remove_video",(function(){plek_band.remove_band_video(this)})),jQuery("#add-band-video").click((function(){plek_band.add_band_video()})),jQuery(document).on("keypress",(function(e){13==e.which&&plek_band.on_enter(e)})),jQuery("#band-name").on("change",e=>{plek_band.check_existing_band()})},on_band_add(){},on_enter(e){let focused=jQuery(":focus").attr("id");console.log(focused),"add-band-video-input"===focused&&(e.preventDefault(),jQuery("#add-band-video").click())},show_youtube_videos(id=null){if(jQuery("#band-videos").after('<div id="video_preview_con"></div>'),null===jQuery("#band-videos").val().length||0===jQuery("#band-videos").val().length){if(null===id)return!1;var videos=[id]}else var videos=jQuery("#band-videos").val().split("\n");console.log(videos),jQuery(videos).each((function(i,val){plek_band.load_youtube_video(val,i)}))},load_youtube_video(video_id,item_id){var data=new FormData;if(0===video_id.length)return!1;data.append("action","plek_band_actions"),data.append("do","get_youtube_video"),data.append("video_id",video_id);let loading='<div class="loading-youtube">'+__("Loading Video","pleklang")+"</div>";jQuery("#video_preview_con").append('<div class="video_preview_item" id="video_'+item_id+'" data-videoid="'+video_id+'">'+loading+"</div>"),jQuery.ajax({url:window.ajaxurl,type:"POST",cache:!1,data:data,processData:!1,contentType:!1,success:function success(data){console.log("success");let cancel_btn='<span class="remove_video" data-videoid="'+video_id+'" data-itemid="'+item_id+'"><i class="fas fa-times"></i></span>';jQuery("#video_"+item_id).html(cancel_btn+data)},error:function error(data){console.log(data)}})},add_band_video(){let new_vid=jQuery("#add-band-video-input").val();jQuery("#add-band-video-input").val("");var videos=jQuery("#band-videos").val().split("\n"),item_id=videos.length;videos.push(new_vid);let vid_join=videos.join("\n");jQuery("#band-videos").val(vid_join),plek_band.load_youtube_video(new_vid,item_id)},remove_band_video(item){jQuery(item).parent().remove(),console.log(item);let id=jQuery(item).data("itemid");var videos=jQuery("#band-videos").val().split("\n");jQuery(videos).each((function(i,val){i==id&&(console.log("found"+i),videos.splice(i))})),console.log(videos);let vid_join=videos.join("\n");console.log(vid_join),jQuery("#band-videos").val(vid_join)},save_band(data){plek_main.activate_button_loader("#band-form-submit",__("Save Band...","pleklang")),plek_main.remove_field_errors();let button=jQuery("#band-form-submit"),form=document.getElementById("plek-band-form");var data=this.prepare_band_data(form);jQuery.ajax({url:window.ajaxurl,type:"POST",cache:!1,processData:!1,contentType:!1,data:data,success:function success(data){let text="",errors;if(!0===plek_main.show_field_errors(data,form))console.log("Contains Errors"),text="Das Formular enthÃ¤lt Fehler, bitte korrigieren";else{text=plek_main.get_first_success_from_ajax_request(data);let band_obj=plek_main.get_ajax_success_object(data);void 0!==band_obj[1]&&band_obj[2]}plek_main.deactivate_button_loader(button,text),0===jQuery(".band-edit").length&&plek_main.clear_form_inputs("plek-band-form"),jQuery("#band-form-cancel").text(__("Back","pleklang")),setTimeout(()=>{jQuery("#band-form-submit").text(plek_band.default_button_texts.submit)},5e3)},error:function error(data){plek_main.deactivate_button_loader(button,__("Error loading data. ","pleklang"))}})},check_existing_band(){if(!empty(jQuery("#band-name").val())){var data=new FormData;data.append("action","plek_band_actions"),data.append("do","check_existing_band"),data.append("band-name",jQuery("#band-name").val()),data.append("band-id",jQuery("#band-id").val()),jQuery.ajax({url:window.ajaxurl,type:"POST",cache:!1,processData:!1,contentType:!1,data:data,success:function success(data){let error=plek_main.get_first_error_from_ajax_request(data);empty(error)||(plekerror.set_toastr(0,!0),plekerror.display_info(__("Info","pleklang"),error),plekerror.reset_toastr())},error:function error(data){plek_main.deactivate_button_loader(button,__("Error loading data. ","pleklang"))}})}},prepare_band_data(form){var data=new FormData(form);data.append("action","plek_band_actions"),data.append("do","save_band");var file_data=jQuery("#band-logo").prop("files")[0];return data.append("band-description",tinymce.editors["band-description"].getContent()),data.append("band-logo-data",file_data),data.append("band-logo","666"),data},toggle_follower(){let band_id=jQuery(".band-single").data("band_id");plek_main.remove_field_errors();let button=jQuery(".plek-follow-band-btn");plek_main.activate_loader_style(button);var data=new FormData;data.append("action","plek_band_actions"),data.append("do","follow_band_toggle"),data.append("band_id",band_id),jQuery.ajax({url:window.ajaxurl,type:"POST",cache:!1,processData:!1,contentType:!1,data:data,success:function success(data){plek_main.deactivate_loader_style(button);let text=plek_main.get_text_from_ajax_request(data,!0),errors;if(!0===plek_main.response_has_errors(data))console.log("Contains Errors"),text=plek_main.get_first_error_from_ajax_request(data);else{let success=plek_main.get_ajax_success_object(data);text=success[1],jQuery(".plek-follow-band-btn .counter").text(success[0])}jQuery(".plek-follow-band-btn .label").text(text)},error:function error(data){plek_main.deactivate_loader_style(button),jQuery(".plek-follow-band-btn .label").text("Error loading data.")}})}};plek_band.construct();