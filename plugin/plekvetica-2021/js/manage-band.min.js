let plek_band={default_button_texts:default_button_texts={},construct(){jQuery("#plek-band-form").length>0?this.on_edit_band():jQuery(document).on("click",".plek-follow-band-btn",(function(){plek_band.toggle_follower(this)}))},on_edit_band(){jQuery(document).ready((function(){jQuery("select").select2({theme:"plek"}),plek_band.show_youtube_videos()})),jQuery("input#band-logo").change((function(){let btn=jQuery(".plek-upload-button-container .plek-button");plek_band.change_file_upload_button(btn,plek_lang.trans("Datei gewählt"))})),default_button_texts.submit=jQuery("#band-form-submit").text(),jQuery("#plek-band-form button").click((function(e){if(e.preventDefault(),"band-form-cancel"!==e.currentTarget.id)if("band-form-submit"!==e.currentTarget.id);else{var data=jQuery("#plek-band-form").serialize();plek_band.save_band(data)}else history.back()})),jQuery(document).on("click",".remove_video",(function(){plek_band.remove_band_video(this)})),jQuery("#add-band-video").click((function(){plek_band.add_band_video()})),jQuery(document).on("keypress",(function(e){13==e.which&&plek_band.on_enter(e)}))},change_file_upload_button(btn,text){jQuery(btn).text(text)},on_enter(e){let focused=jQuery(":focus").attr("id");console.log(focused),"add-band-video-input"===focused&&(e.preventDefault(),jQuery("#add-band-video").click())},show_youtube_videos(id=null){if(jQuery("#band-videos").after('<div id="video_preview_con"></div>'),null===jQuery("#band-videos").val().length||0===jQuery("#band-videos").val().length){if(null===id)return!1;var videos=[id]}else var videos=jQuery("#band-videos").val().split("\n");console.log(videos),jQuery(videos).each((function(i,val){plek_band.load_youtube_video(val,i)}))},load_youtube_video(video_id,item_id){var data=new FormData;if(0===video_id.length)return!1;data.append("action","plek_band_actions"),data.append("do","get_youtube_video"),data.append("video_id",video_id);let loading='<div class="loading-youtube">'+plek_lang.trans("Lade Video")+"</div>";jQuery("#video_preview_con").append('<div class="video_preview_item" id="video_'+item_id+'" data-videoid="'+video_id+'">'+loading+"</div>"),jQuery.ajax({url:window.ajaxurl,type:"POST",cache:!1,data:data,processData:!1,contentType:!1,success:function success(data){console.log("success");let cancel_btn='<span class="remove_video" data-videoid="'+video_id+'" data-itemid="'+item_id+'"><i class="fas fa-times"></i></span>';jQuery("#video_"+item_id).html(cancel_btn+data)},error:function error(data){console.log(data)}})},add_band_video(){let new_vid=jQuery("#add-band-video-input").val();jQuery("#add-band-video-input").val("");var videos=jQuery("#band-videos").val().split("\n"),item_id=videos.length;videos.push(new_vid);let vid_join=videos.join("\n");jQuery("#band-videos").val(vid_join),plek_band.load_youtube_video(new_vid,item_id)},remove_band_video(item){jQuery(item).parent().remove(),console.log(item);let id=jQuery(item).data("itemid");var videos=jQuery("#band-videos").val().split("\n");jQuery(videos).each((function(i,val){i==id&&(console.log("found"+i),videos.splice(i))})),console.log(videos);let vid_join=videos.join("\n");console.log(vid_join),jQuery("#band-videos").val(vid_join)},save_band(data){plek_main.activate_button_loader("#band-form-submit","Speichere Einstellungen..."),plek_main.remove_field_errors();let button=jQuery("#band-form-submit"),form=document.getElementById("plek-band-form");var data;(data=new FormData(form)).append("action","plek_band_actions"),data.append("do","save_band");var file_data=jQuery("#band-logo").prop("files")[0];data.append("band-description",tinymce.editors["band-description"].getContent()),data.append("band-logo-data",file_data),data.append("band-logo","666"),jQuery.ajax({url:window.ajaxurl,type:"POST",cache:!1,processData:!1,contentType:!1,data:data,success:function success(data){let text=plek_main.get_text_from_ajax_request(data,!0),errors;!0===plek_main.show_field_errors(data,form)?(console.log("Contains Errors"),text="Das Formular enthält Fehler, bitte korrigieren"):text=plek_main.get_text_from_ajax_request(data,!0),plek_main.deactivate_button_loader(button,text),jQuery("#band-form-cancel").text(plek_lang.trans("Zurück")),setTimeout(()=>{jQuery("#band-form-submit").text(plek_band.default_button_texts.submit)},5e3)},error:function error(data){plek_main.deactivate_button_loader(button,"Error loading data.... ")}})},toggle_follower(){let band_id=jQuery(".band-single").data("band_id");plek_main.remove_field_errors();let button=jQuery(".plek-follow-band-btn");var data=new FormData;data.append("action","plek_band_actions"),data.append("do","follow_band_toggle"),data.append("band_id",band_id),jQuery.ajax({url:window.ajaxurl,type:"POST",cache:!1,processData:!1,contentType:!1,data:data,success:function success(data){let text=plek_main.get_text_from_ajax_request(data,!0),errors;!0===plek_main.response_has_errors(data)?(console.log("Contains Errors"),text=plek_main.get_first_error_from_ajax_request(data)):text=plek_main.get_text_from_ajax_request(data,!0),jQuery(".plek-follow-band-btn").text(text)},error:function error(data){plek_main.deactivate_button_loader(button,"Error loading data.... ")}})}};plek_band.construct();