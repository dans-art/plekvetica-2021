let plek_user={default_button_texts:{},construct(){plek_user.default_button_texts.submit=jQuery("#user-settings-submit").text(),jQuery("#plek-submit").click((function(e){e.preventDefault();let type=jQuery(this).data("type");plek_user.submit(type)})),jQuery('#register-new-user input[type!="submit"]').click((function(){jQuery("#plek-submit").val(plek_user.default_button_texts.submit)})),jQuery("#lostpasswordform #plek-submit").click((function(){jQuery("#plek-submit").val(plek_user.default_button_texts.submit)})),jQuery("#plek-user-settings-form button").click((function(e){if(e.preventDefault(),"user-settings-cancel"!==e.currentTarget.id){var data=jQuery("#plek-user-settings-form").serialize();plek_user.save_user_settings(data)}else{var prev_url=document.referrer;if("undefined"!=typeof URLSearchParams&&prev_url.includes("?")){var params=new URLSearchParams(prev_url);params.delete("key"),params.delete("unlock"),prev_url=unescape(params.toString())}location.href=prev_url}}))},submit(type){switch(type){case"add-user-account":this.add_user_account();break;case"resetpassword":this.reset_password();break;case"set_new_password":this.set_new_password();break;default:console.log("Submit Type not found: "+type)}},add_user_account(){let button=jQuery("#plek-submit"),button_cta=button.text();plek_main.activate_button_loader("#plek-submit","Erstelle Konto..."),plek_main.remove_field_errors();let data=jQuery("#register-new-user-form").serialize();data+="&action=plek_user_actions",data+="&do=add_user_account",jQuery.ajax({url:window.ajaxurl,type:"POST",cache:!1,data:data,success:function success(data){let text=plek_main.get_text_from_ajax_request(data,!0),errors;!0===plek_main.show_field_errors(data,"#register-new-user-form")?(text="Das Formular enthält Fehler, bitte korrigieren",plek_user.reset_button_text_after_input_focus(button,button_cta)):(plek_main.deactivate_button(button),jQuery('#register-new-user input[type!="submit"]').val("")),plek_main.deactivate_button_loader(button,text)},error:function error(data){plek_main.deactivate_button_loader(button,__("Error loading data. ","pleklang"))}})},reset_password(){let button=jQuery("#plek-submit"),button_cta=button.val();plek_main.activate_button_loader("#plek-submit",__("Sending password reset request...","pleklang")),plek_main.remove_field_errors();let data=jQuery("#lostpasswordform").serialize();data+="&action=plek_user_actions",data+="&do=reset_password",jQuery.ajax({url:window.ajaxurl,type:"POST",cache:!1,data:data,success:function success(data){let text=plek_main.get_text_from_ajax_request(data,!0),errors;!0===plek_main.show_field_errors(data,"#lostpasswordform")?(text=__("The form contains errors, please fix them","pleklang"),plek_user.reset_button_text_after_input_focus(button,button_cta),plekerror.display_error(!1,text,__("Password reset","pleklang"))):(plek_main.deactivate_button(button),jQuery('#lostpasswordform input[type!="submit"]').val(""),plekerror.display_success(__("Password reset","pleklang"),text),empty(jQuery("#redirect_to").attr("value"))||plek_main.redirect_to_url(jQuery("#redirect_to").attr("value"),4e3)),plek_main.deactivate_button_loader(button,button_cta)},error:function error(data){plek_main.deactivate_button_loader(button,__("Error loading data. ","pleklang"))}})},set_new_password(){let button=jQuery("#plek-submit"),button_cta=button.val();plek_main.activate_button_loader("#plek-submit",__("Save new password...","pleklang")),plek_main.remove_field_errors();let data=jQuery("#set_new_password_form").serialize();data+="&action=plek_user_actions",data+="&do=set_new_password",jQuery.ajax({url:window.ajaxurl,type:"POST",cache:!1,data:data,success:function success(data){let text=plek_main.get_text_from_ajax_request(data,!0),errors;!0===plek_main.show_field_errors(data,"#set_new_password_form")?(text=__("The form contains errors, please fix them","pleklang"),plek_user.reset_button_text_after_input_focus(button,button_cta),plekerror.display_error(__("Password reset","pleklang"),text)):(plek_main.deactivate_button(button),jQuery('#set_new_password_form input[type!="submit"]').val(""),jQuery(button).hide(),jQuery("#to-my-plek-page-button").show(),plekerror.display_success(__("Password reset","pleklang"),text)),plek_main.deactivate_button_loader(button,button_cta)},error:function error(data){plek_main.deactivate_button_loader(button,__("Error loading data. ","pleklang"))}})},save_user_settings(data){plek_main.activate_button_loader("#user-settings-submit","Speichere Einstellungen..."),plek_main.remove_field_errors();let button=jQuery("#user-settings-submit");data+="&action=plek_user_actions",data+="&do=save_user_settings",jQuery.ajax({url:window.ajaxurl,type:"POST",cache:!1,data:data,success:function success(data){let text=plek_main.get_text_from_ajax_request(data,!0),errors;!0===plek_main.show_field_errors(data,"#plek-user-settings-form")?(console.log("Contains Errors"),text="Das Formular enthält Fehler, bitte korrigieren"):text=plek_main.get_text_from_ajax_request(data,!0),plek_main.deactivate_button_loader(button,text),jQuery("#user-settings-cancel").text(__("Back","pleklang")),setTimeout(()=>{jQuery("#user-settings-submit").text(plek_user.default_button_texts.submit)},5e3)},error:function error(data){plek_main.deactivate_button_loader(button,__("Error loading data. ","pleklang"))}})},reset_button_text_after_input_focus(button,text){jQuery("input").focus((function(){jQuery(button).text(text)}))}};plek_user.construct();