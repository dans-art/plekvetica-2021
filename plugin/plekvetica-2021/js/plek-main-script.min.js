let plek_main={construct(){jQuery(window).resize(),jQuery(document).ready((function(){plek_main.add_event_listener(),plek_main.content_loader(),plek_main.config_topbar(),topbar.show()}))},config_topbar(){topbar.config({autoRun:!0,barThickness:3,barColors:{0:"#8C262E","1.0":"#8C262E"},shadowBlur:10,shadowColor:"rgba(0,   0,   0,   .6)"})},activate_button_loader(element,text){this.activate_loader_style(element),jQuery(element).is("input")?jQuery(element).val(text):jQuery(element).html(text)},deactivate_button_loader(element,text){this.deactivate_loader_style(element),jQuery(element).is("input")?jQuery(element).val(text):jQuery(element).html(text)},deactivate_button(element){jQuery(element).off("click"),jQuery(element).addClass("deactivate"),jQuery(element).prop("disabled",!0)},disable_button(element){jQuery(element).addClass("disable")},activate_loader_style(element){if(jQuery(element).addClass("loader"),jQuery(element).is("input")){let btn_id=jQuery(element).attr("id");jQuery(element).after(`<div id='input_loader_${btn_id}' class='input_loader'></div>`)}},deactivate_loader_style(element){if(jQuery(element).removeClass("loader"),jQuery(element).is("input")){let btn_id=jQuery(element).attr("id");jQuery("#input_loader_"+btn_id).remove()}},get_text_from_ajax_request(data,only_success=!1){try{let encoded_data=JSON.parse(data),text="";return encoded_data.success.length>0&&(text+=encoded_data.success),only_success?text:(encoded_data.error.length>0&&(text+=0===text.length?"":"<br/>",text+="Error: "+encoded_data.error),encoded_data.system_error.length>0&&(text+=0===text.length?"":"<br/>",text+="Error: "+encoded_data.system_error),text)}catch(e){return data}},content_loader(){let items=jQuery(".plek-load-content");0!=items.length&&jQuery(items).each((function(index){var current_item=this;jQuery(current_item).text("Loading");let to_load=jQuery(this).data("plek-content-loader");var button_id=jQuery(this).data("counter-button-id"),send_data=new FormData;send_data.append("action","plek_content_loader"),send_data.append("do",to_load),jQuery.ajax({url:window.ajaxurl,type:"POST",cache:!1,processData:!1,contentType:!1,data:send_data,success:function success(data){let encoded_data=JSON.parse(data),content=encoded_data.content,count=encoded_data.count;jQuery(current_item).html(content),jQuery("#"+button_id).text(count)},error:function error(data){jQuery(current_item).text("Error loading data.")}})}))},add_event_listener(){jQuery("#page").on("click",".ajax-block-loader-button",(function(e){e.preventDefault(),plek_main.load_block(this)})),jQuery(".plek-menu-search").on("click","a",(function(e){e.preventDefault(),jQuery(".plek-menu-search input").val().length>0?plek_main.redirect_to_search(this):jQuery(".plek-menu-search input").focus()})),jQuery(".plek-menu-search input").keypress((function(e){var keycode;13===(e.keyCode?e.keyCode:e.which)&&plek_main.redirect_to_search(this)})),jQuery("#main").on("click","#notifications-button",(function(e){plek_main.toggle_notification_container(this)})),jQuery("#notifications-container").on("click",".dismiss_notification",(function(e){plek_main.dismiss_notification(this)})),jQuery("input[type='file']").change((function(){plek_main.image_upload_button_change(this)}))},image_upload_button_change(item){let text=__("File selected","pleklang");var upload=jQuery(item).prop("files")[0],id=jQuery(item).attr("id");if("object"==typeof upload){if(0===upload.type.search("image/")){var reader=new FileReader;reader.onload=function(e){jQuery("#"+id+"-image img").attr("src",e.target.result)},reader.readAsDataURL(upload)}jQuery(item).next(".plek-button").text(text)}},redirect_to_search(search){if("INPUT"===search.nodeName)var search_for=jQuery(search).val();else var search_for=jQuery(search).parent().find("input").val();let url=window.location.protocol+"//"+window.location.hostname+"?s="+search_for;window.location.replace(url)},get_ajax_success_object(data){try{let encoded_data="object"==typeof data?data:JSON.parse(data);if(encoded_data.success.length>0)return encoded_data.success}catch(e){return console.warn("Data could not converted into JSON data at get_ajax_success_object()"),data}},get_first_error_from_ajax_request(data){try{let encoded_data="object"==typeof data?data:JSON.parse(data),text="";return encoded_data.error.length>0&&(text+=encoded_data.error[0]),text}catch(e){return data}},get_first_success_from_ajax_request(data){try{let encoded_data="object"==typeof data?data:JSON.parse(data),text="";return encoded_data.success.length>0&&(text+=encoded_data.success[0]),text}catch(e){return data}},response_has_errors(data){try{var encoded_data=data;return"object"!=typeof data&&(encoded_data=JSON.parse(data)),0!==encoded_data.error.length}catch(e){return console.log(e),!1}},show_field_errors(data,form="form",display_unassigned_as_toastr=!0){let error_count=0;try{var encoded_data=data;"object"!=typeof data&&(encoded_data=JSON.parse(data));for(const[id,value]of Object.entries(encoded_data.error)){if("object"==typeof value)for(const[sub_id,sub_value]of Object.entries(value))jQuery(sub_value).each((function(i){var field_selector;if(console.log("set "+sub_id),0===(field_selector=jQuery("#"+sub_id)).length)var field_selector=jQuery(form);jQuery(field_selector).after(plek_main.format_error_message(sub_value[i])),error_count++}));"string"==typeof value&&(display_unassigned_as_toastr?plekerror.display_error(!1,value,__("Error","pleklang")):jQuery(form).after(plek_main.format_error_message(value)),console.log("not assigned"),console.log(form),error_count++),jQuery(value).each((function(i){jQuery("#"+id).after(plek_main.format_error_message(value[i])),error_count++}))}return 0!==error_count}catch(e){return console.log(e),!0}},remove_field_errors(){jQuery(".plek-field-error").remove()},format_error_message:msg=>`<span class="plek-error plek-field-error">${msg}</span>`,load_block(button){let container=jQuery(button).closest(".block-container");plek_main.remove_field_errors(),plek_main.activate_loader_style(button);var send_data=new FormData;send_data.append("action","plek_event_actions"),send_data.append("do","load_block_content"),send_data=plek_main.get_block_data(container,send_data,button),send_data=plek_main.get_url_query_data(send_data),jQuery.ajax({url:window.ajaxurl,type:"POST",cache:!1,processData:!1,contentType:!1,data:send_data,success:function success(data){plek_main.deactivate_loader_style(button);let text=plek_main.get_text_from_ajax_request(data,!0),errors;if(!0===plek_main.response_has_errors(data))console.log("Contains Errors"),text=plek_main.get_first_error_from_ajax_request(data);else{jQuery(container).replaceWith(text);let page=send_data.get("paged"),block_id=send_data.get("block_id");page&&(window.history.pushState({},"Page",plek_main.url_add_page(page,block_id,send_data)),plek_main.scroll_to_block(block_id))}jQuery(button).text(text)},error:function error(data){plek_main.deactivate_loader_style(button),jQuery(button).text("Error loading data.")}})},get_block_data(container,formdata,button){for(const[id,val]of Object.entries(jQuery(container).data()))"paged"!==id&&formdata.append(id,val);return formdata.append("paged",jQuery(button).data("paged")),formdata},get_url_query_data(formdata){let items=["order","direction","s","search_reviews"],url=new URLSearchParams(window.location.search);return jQuery(items).each((function(id,name){let val=url.get(name);null!==val&&val.length>0&&formdata.append(name,val)})),formdata},url_add_page(page_number,block_id,send_data){var url_object=new URLSearchParams(window.location.search);let base=window.location.pathname,query=window.location.search,new_url="";var separator=-1===query.indexOf("?")?"?":"&";return base.search("page/")>0?new_url=base.replace(/(page\/[0-9]+)/,"page/"+page_number):(new_url=base+"/page/"+page_number,new_url=new_url.replace("//","/",base+"/page/"+page_number)),new_url+=query,new_url=query.search("block_id=")>0?new_url.replace(/block_id=([A-z0-9_-]*)/,"block_id="+block_id):new_url+separator+"block_id="+block_id,null!==url_object.get(s)&&0===query.search("s=")&&(new_url=new_url+separator+"s="+url_object.get(s)),new_url},url_replace_param(param,value,update_url=!0){let query=window.location.search;if(query.indexOf(param+"="+value)>0)return window.location.origin+window.location.pathname+query;let regex=new RegExp(param+"=([A-z0-9_-]*)"),new_query=query.replace(regex,param+"="+value);if(query===new_query){let separator=-1===query.indexOf("?")?"?":"&";new_query=query+separator+param+"="+value}let new_url=window.location.origin+window.location.pathname+new_query;return update_url&&this.update_browser_url(new_url,document.title),new_url},update_browser_url(url,title){window.history.pushState({},title,url),document.title=title},scroll_to_block(block_id){try{let position=jQuery(".block-"+block_id).offset().top;jQuery("html").animate({scrollTop:position-110},800)}catch(e){console.log("Block: "+block_id+" not found in container")}},toggle_notification_container(item){jQuery("#notifications-container").is(":hidden")?jQuery("#notifications-container").show(100,(function(){jQuery("body").on("click",(function(event){jQuery(event.target).closest("#notifications-container").length||(jQuery("#notifications-container").hide(100),jQuery("body").off("click"))}))})):jQuery("#notifications-container").hide(100)},dismiss_notification(item){var dismiss_id=jQuery(item).data("dismiss-id");jQuery(item).find("i").removeClass("fa-times"),jQuery(item).find("i").addClass("fa-spinner");var send_data=new FormData;send_data.append("action","plek_user_actions"),send_data.append("do","dismiss_notification"),send_data.append("dissmiss_id",dismiss_id),jQuery.ajax({url:window.ajaxurl,type:"POST",cache:!1,processData:!1,contentType:!1,data:send_data,success:function success(data){let errors;!0===plek_main.response_has_errors(data)?console.log("Contains Errors: "+plek_main.get_first_error_from_ajax_request(data)):jQuery("#notification_"+dismiss_id).addClass("dismissed")},error:function error(data){}})}};plek_main.construct();