let plek_main={construct(){jQuery(window).resize(),jQuery(document).ready(function(){plek_main.add_event_listener(),plek_main.content_loader(),plek_main.config_topbar(),topbar.show()})},config_topbar(){topbar.config({autoRun:!0,barThickness:3,barColors:{0:"#8C262E","1.0":"#8C262E"},shadowBlur:10,shadowColor:"rgba(0,   0,   0,   .6)"})},activate_button_loader(e,t){this.activate_loader_style(e),jQuery(e).is("input")?jQuery(e).val(t):jQuery(e).html(t)},deactivate_button_loader(e,t){this.deactivate_loader_style(e),jQuery(e).is("input")?jQuery(e).val(t):jQuery(e).html(t)},deactivate_button(e){jQuery(e).off("click"),jQuery(e).addClass("deactivate"),jQuery(e).prop("disabled",!0)},disable_button(e){jQuery(e).addClass("disable")},activate_loader_style(e){if(jQuery(e).addClass("loader"),jQuery(e).is("input")){let t=jQuery(e).attr("id");jQuery(e).after(`<div id='input_loader_${t}' class='input_loader'></div>`)}},deactivate_loader_style(e){if(jQuery(e).removeClass("loader"),jQuery(e).is("input")){let t=jQuery(e).attr("id");jQuery("#input_loader_"+t).remove()}},get_text_from_ajax_request(e,t=!1){try{let r=JSON.parse(e),a="";return r.success.length>0&&(a+=r.success),t?a:(r.error.length>0&&(a+=0===a.length?"":"<br/>",a+="Error: "+r.error),r.system_error.length>0&&(a+=0===a.length?"":"<br/>",a+="Error: "+r.system_error),a)}catch(t){return e}},content_loader(){let e=jQuery(".plek-load-content");0!=e.length&&jQuery(e).each(function(e){var t=this;jQuery(t).text("Loading");let r=jQuery(this).data("plek-content-loader");var a=jQuery(this).data("counter-button-id"),o=new FormData;o.append("action","plek_content_loader"),o.append("do",r),jQuery.ajax({url:window.ajaxurl,type:"POST",cache:!1,processData:!1,contentType:!1,data:o,success:function(e){let r=JSON.parse(e),o=r.content,n=r.count;jQuery(t).html(o),jQuery("#"+a).text(n)},error:function(e){jQuery(t).text("Error loading data....")}})})},add_event_listener(){jQuery("#page").on("click",".ajax-block-loader-button",function(e){e.preventDefault(),plek_main.load_block(this)}),jQuery(".plek-menu-search").on("click","a",function(e){e.preventDefault(),jQuery(".plek-menu-search input").val().length>0?plek_main.redirect_to_search(this):jQuery(".plek-menu-search input").focus()}),jQuery(".plek-menu-search input").keypress(function(e){13===(e.keyCode?e.keyCode:e.which)&&plek_main.redirect_to_search(this)}),jQuery("#main").on("click","#notifications-button",function(e){plek_main.toggle_notification_container(this)}),jQuery("#notifications-container").on("click",".dismiss_notification",function(e){plek_main.dismiss_notification(this)}),jQuery("input[type='file']").change(function(){plek_main.image_upload_button_change(this)})},image_upload_button_change(e){let t=__("File selected","pleklang");var r=jQuery(e).prop("files")[0],a=jQuery(e).attr("id");if("object"==typeof r){if(0===r.type.search("image/")){var o=new FileReader;o.onload=function(e){jQuery("#"+a+"-image img").attr("src",e.target.result)},o.readAsDataURL(r)}jQuery(e).next(".plek-button").text(t)}},redirect_to_search(e){if("INPUT"===e.nodeName)t=jQuery(e).val();else var t=jQuery(e).parent().find("input").val();let r=window.location.protocol+"//"+window.location.hostname+"?s="+t;window.location.replace(r)},get_ajax_success_object(e){try{let t="object"==typeof e?e:JSON.parse(e);if(t.success.length>0)return t.success}catch(t){return console.warn("Data could not converted into JSON data at get_ajax_success_object()"),e}},get_first_error_from_ajax_request(e){try{let t="object"==typeof e?e:JSON.parse(e),r="";return t.error.length>0&&(r+=t.error[0]),r}catch(t){return e}},get_first_success_from_ajax_request(e){try{let t="object"==typeof e?e:JSON.parse(e),r="";return t.success.length>0&&(r+=t.success[0]),r}catch(t){return e}},response_has_errors(e){try{var t=e;return"object"!=typeof e&&(t=JSON.parse(e)),0!==t.error.length}catch(e){return console.log(e),!1}},show_field_errors(e,t="form",r=!0){let a=0;try{var o=e;"object"!=typeof e&&(o=JSON.parse(e));for(const[e,n]of Object.entries(o.error)){if("object"==typeof n)for(const[e,r]of Object.entries(n))jQuery(r).each(function(o){console.log("set "+e);if(0===(n=jQuery("#"+e)).length)var n=jQuery(t);jQuery(n).after(plek_main.format_error_message(r[o])),a++});"string"==typeof n&&(r?plekerror.display_error(!1,n,__("Error","pleklang")):jQuery(t).after(plek_main.format_error_message(n)),console.log("not assigned"),console.log(t)),jQuery(n).each(function(t){jQuery("#"+e).after(plek_main.format_error_message(n[t])),a++})}return 0!==a}catch(e){return console.log(e),!0}},remove_field_errors(){jQuery(".plek-field-error").remove()},format_error_message:e=>`<span class="plek-error plek-field-error">${e}</span>`,load_block(e){let t=jQuery(e).closest(".block-container");plek_main.remove_field_errors(),plek_main.activate_loader_style(e);var r=new FormData;r.append("action","plek_event_actions"),r.append("do","load_block_content"),r=plek_main.get_block_data(t,r,e),r=plek_main.get_url_query_data(r),jQuery.ajax({url:window.ajaxurl,type:"POST",cache:!1,processData:!1,contentType:!1,data:r,success:function(a){plek_main.deactivate_loader_style(e);let o=plek_main.get_text_from_ajax_request(a,!0);if(!0===plek_main.response_has_errors(a))console.log("Contains Errors"),o=plek_main.get_first_error_from_ajax_request(a);else{jQuery(t).replaceWith(o);let e=r.get("paged"),a=r.get("block_id");e&&(window.history.pushState({},"Page",plek_main.url_add_page(e,a,r)),plek_main.scroll_to_block(a))}jQuery(e).text(o)},error:function(t){plek_main.deactivate_loader_style(e),jQuery(e).text("Error loading data....")}})},get_block_data(e,t,r){for(const[r,a]of Object.entries(jQuery(e).data()))"paged"!==r&&t.append(r,a);return t.append("paged",jQuery(r).data("paged")),t},get_url_query_data(e){let t=new URLSearchParams(window.location.search);return jQuery(["order","direction","s","search_reviews"]).each(function(r,a){let o=t.get(a);null!==o&&o.length>0&&e.append(a,o)}),e},url_add_page(e,t,r){var a=new URLSearchParams(window.location.search);let o=window.location.pathname,n=window.location.search,i="";var l=-1===n.indexOf("?")?"?":"&";return i=o.search("page/")>0?o.replace(/(page\/[0-9]+)/,"page/"+e):(i=o+"/page/"+e).replace("//","/",o+"/page/"+e),i+=n,i=n.search("block_id=")>0?i.replace(/block_id=([A-z0-9_-]*)/,"block_id="+t):i+l+"block_id="+t,null!==a.get(s)&&0===n.search("s=")&&(i=i+l+"s="+a.get(s)),i},url_replace_param(e,t,r=!0){let a=window.location.search;if(a.indexOf(e+"="+t)>0)return window.location.origin+window.location.pathname+a;let o=new RegExp(e+"=([A-z0-9_-]*)"),n=a.replace(o,e+"="+t);if(a===n){n=a+(-1===a.indexOf("?")?"?":"&")+e+"="+t}let i=window.location.origin+window.location.pathname+n;return r&&this.update_browser_url(i,document.title),i},update_browser_url(e,t){window.history.pushState({},t,e),document.title=t},scroll_to_block(e){try{let t=jQuery(".block-"+e).offset().top;jQuery("html").animate({scrollTop:t-110},800)}catch(t){console.log("Block: "+e+" not found in container")}},toggle_notification_container(e){jQuery("#notifications-container").is(":hidden")?jQuery("#notifications-container").show(100,function(){jQuery("body").on("click",function(e){jQuery(e.target).closest("#notifications-container").length||(jQuery("#notifications-container").hide(100),jQuery("body").off("click"))})}):jQuery("#notifications-container").hide(100)},dismiss_notification(e){var t=jQuery(e).data("dismiss-id");jQuery(e).find("i").removeClass("fa-times"),jQuery(e).find("i").addClass("fa-spinner");var r=new FormData;r.append("action","plek_user_actions"),r.append("do","dismiss_notification"),r.append("dissmiss_id",t),jQuery.ajax({url:window.ajaxurl,type:"POST",cache:!1,processData:!1,contentType:!1,data:r,success:function(e){!0===plek_main.response_has_errors(e)?console.log("Contains Errors: "+plek_main.get_first_error_from_ajax_request(e)):jQuery("#notification_"+t).addClass("dismissed")},error:function(e){}})}};plek_main.construct();