"use strict";var flatpickr_options={locale:"de",enableTime:!0,dateFormat:"d-m-Y H:i:S",altInput:!0,altFormat:"j. F Y - H:i",onChange:function(selectedDates,dateStr,instance){plekerror.clear_field_error(jQuery(instance.input).attr("id"))}};jQuery(document).ready((function(){console.log("Ready!"),ajaxPreloader("bands"),ajaxPreloader("venues"),ajaxPreloader("organizers"),flatpickr("#event_start_date",flatpickr_options),flatpickr("#event_end_date",flatpickr_options),jQuery("#is_multiday").click((function(){jQuery(this).is(":checked")?show_end_date():hide_end_date()})),jQuery("#no_band").click((function(){jQuery(this).is(":checked")?(disable_band_input(),jQuery("#event-band-selection").hide()):(jQuery("#event-band-selection").show(),enable_band_input())})),jQuery("#event_start_date").change((function(){var start_date=jQuery("#event_start_date").val(),end_options=flatpickr_options;end_options.minDate=start_date,flatpickr("#event_end_date",end_options)})),jQuery("#plek-submit").click((function(event){event.preventDefault(),jQuery(this).prop("disabled",!0);var type=jQuery(this).data("type");window.plekevent.save_event(type)})),jQuery("#main").on("click","#plek-add-login-submit",(function(event){event.preventDefault(),jQuery(this).prop("disabled",!0);var type=jQuery(this).data("type");window.plekevent.save_event_login(type)})),jQuery(".plek-search-input").focus((function(element){plektemplate.hide_overlay(),plektemplate.show_overlay(this)})),jQuery(".plek-search-input").keyup((function(element){var input_length;0!==jQuery(this).val().length?pleksearch.fire_search(this):window.plektemplate.hide_overlay()})),jQuery(".event-organizer-proposal-item").click((function(element){window.plekevent.add_item_to_selection(this)})),jQuery("input").on("keyup",(function(){plekerror.clear_field_error(jQuery(this).attr("id"))})),jQuery("#main").on("click","#add_as_guest",(function(){plek_add_event_functions.show_guest_login()})),jQuery("#main").on("click","#add_login",(function(){plek_add_event_functions.show_login_form()})),jQuery("#event_band_overlay").on("click","#add-new-band",(function(){plek_add_event_functions.show_add_band_form()})),jQuery(document).keypress((function(e){var keycode;13===(e.keyCode?e.keyCode:e.which)&&"plek-submit"!==jQuery(e.target).prop("id")&&(console.log(e.target),console.log("Not submit"))}))}));let plek_manage_event={__construct(){this.add_event_listeners()},add_event_listeners(){jQuery(".plek-form").on("click",".plek-button",(function(e){let button_id=e.currentTarget.id;e.preventDefault(),plek_manage_event.send_vob_form(button_id)})),jQuery(".plek-form").on("click",".plek-button-cancel",(function(e){let button_id=e.currentTarget.id;e.preventDefault(),plek_manage_event.vob_form_cancel(button_id)}))},send_vob_form(type=null){let default_submit_btn_text=jQuery("#"+type).text();var data;if(void 0===(data=jQuery("#"+type).serialize()))return console.log("Type not found: "+type),!1;let vob_form_name="";switch(type){case"band-form-submit":vob_form_name="band";break;case"venue-form-submit":vob_form_name="venue";break;case"orgnaizer-form-submit":vob_form_name="organizer";break;default:return!1}plek_main.activate_button_loader("#"+type,__("Save...","pleklang")),plek_main.remove_field_errors();let button=jQuery("#"+type),form=document.getElementById("plek-"+vob_form_name+"-form");var data=this.prepare_vob_data(form,type);if(!0!==plekvalidator.validate_form_data(data,"add_"+vob_form_name))return jQuery("#"+type).prop("disabled",!1),plekvalidator.display_errors("add_"+vob_form_name),plek_main.deactivate_button_loader(button,default_submit_btn_text),!1;jQuery.ajax({url:window.ajaxurl,type:"POST",cache:!1,processData:!1,contentType:!1,data:data,success:function success(data){let text="",errors;if(!0===plek_main.show_field_errors(data,form))console.log("Contains Errors"),text="Das Formular enthÃ¤lt Fehler, bitte korrigieren";else{text=plek_main.get_first_success_from_ajax_request(data);let return_obj=plek_main.get_ajax_success_object(data);void 0===return_obj?plekerror.display_error(null,__("Oops, something went wrong.... sorry!","pleklang"),__("Invalid Response","pleklang")):void 0!==return_obj[1]&&void 0!==return_obj[2]&&"undefined"!=typeof plekevent&&void 0!==return_obj[2][return_obj[1]]&&plekevent.add_new_vob_to_selection(type,return_obj[1],return_obj[2])}plek_main.deactivate_button_loader(button,text),jQuery("#"+type+" .plek-button-cancel").text(__("Back","pleklang")),setTimeout(()=>{jQuery("#"+type).text(default_submit_btn_text)},5e3)},error:function error(data){plek_main.deactivate_button_loader(button,__("Error loading data.... ","pleklang"))}})},prepare_vob_data(form,type){if("object"!=typeof form)return!1;var data=new FormData(form);switch(type){case"band-form-submit":data.append("action","plek_band_actions"),data.append("do","save_band");var file_data=jQuery("#band-logo").prop("files")[0];data.append("band-description",tinymce.editors["band-description"].getContent()),data.append("band-logo-data",file_data),data.append("band-logo","666"),plekvalidator.add_field("band-id","int",!0,"add_band"),plekvalidator.add_field(["band-name"],"text",!1,"add_band");break;case"venue-form-submit":data.append("action","plek_venue_actions"),data.append("do","save_venue"),plekvalidator.add_field("venue-id","int",!0,"add_venue"),plekvalidator.add_field(["venue-name","venue-street","venue-city","venue-country"],"text",!1,"add_venue"),plekvalidator.add_field(["venue-province"],"text",!0,"add_venue"),plekvalidator.add_field("venue-zip","int",!1,"add_venue"),plekvalidator.add_field("venue-phone","phone",!0,"add_venue"),plekvalidator.add_field("venue-web","url",!0,"add_venue"),plekvalidator.add_invalid_field_values("venue-country",["null"],"add_venue"),plekvalidator.add_error_messages("venue-country","add_venue",null,null,null,null,null,__("Please select a country","pleklang"))}return data},vob_form_cancel(button_id){if(0===jQuery("#"+button_id).closest(".overlay_content").length)window.location=document.referrer;else{let overlay_id=jQuery("#"+button_id).closest(".overlay_content").parent().prop("id");overlay_id=overlay_id.replace("_overlay",""),plektemplate.hide_overlay(overlay_id)}}};function ajaxPreloader(type){var datab=new FormData;datab.append("action","plek_ajax_event_form"),datab.append("type","get_"+type),jQuery.ajax({url:window.ajaxurl,data:datab,type:"POST",cache:!1,processData:!1,contentType:!1,success:function success(data){if(data.length<2)return toastr.error(__("Error loading data","pleklang")+": "+type,"Error"),!1;var jdata=JSON.parse(data);return console.log(type+"-Data loaded ("+Object.keys(jdata).length+")"),"bands"===type?void(window.bandPreloadedData=jdata):"venues"===type?void(window.venuePreloadedData=jdata):"organizers"===type&&void(window.organizerPreloadedData=jdata)},error:function error(data){return window.plekerror.display_info(__("Error loading data","pleklang")+": "+data,"Error"),!1}})}function show_end_date(){jQuery(".plek-multi-date").show()}function hide_end_date(){jQuery(".plek-multi-date").hide()}function disable_band_input(){jQuery("input#event_band").prop("disabled",!0),jQuery(".event-search-bar-container plek-button").addClass("disabled"),jQuery(".event-search-bar-container #event_band").addClass("disabled"),jQuery(".event-band-selection").hide()}function enable_band_input(){jQuery("input#event_band").prop("disabled",!1),jQuery(".event-search-bar-container plek-button").removeClass("disabled"),jQuery(".event-search-bar-container #event_band").removeClass("disabled"),jQuery(".event-band-selection").show()}plek_manage_event.__construct();let plek_add_event_functions={show_guest_login(){this.hide_login_containers(),jQuery("#plek-event-guest-login-form-container").show(200),jQuery("#submit-add-event-login-from").show(),jQuery("#add_as_guest").addClass("selected")},show_login_form(){this.hide_login_containers(),jQuery("#plek-event-member-login-form-container").show(200),jQuery("#submit-add-event-login-from").show(),jQuery("#add_login").addClass("selected")},hide_login_containers(){jQuery("#submit-add-event-login-from, #plek-event-member-login-form-container, #plek-event-guest-login-form-container").hide(),jQuery("#add_login, #add_as_guest").removeClass("selected")},show_add_band_form(){plektemplate.hide_overlay(),plektemplate.show_overlay("add_band")}};plek_add_event_functions.hide_login_containers();