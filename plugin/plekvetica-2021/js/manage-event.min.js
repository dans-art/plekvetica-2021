"use strict";var flatpickr_options={locale:"de",enableTime:!0,dateFormat:"Y-m-d H:i:S",altInput:!0,altFormat:"j. F Y - H:i",onChange:function(selectedDates,dateStr,instance){plekerror.clear_field_error(jQuery(instance.input).attr("id"))}};jQuery(document).ready((function(){console.log("Ready!"),jQuery("select:not(.no-select2)").select2({theme:"plek"}),jQuery(document).keypress((function(e){var keycode;13===(e.keyCode?e.keyCode:e.which)&&!1===jQuery(e.target).hasClass("plek-submit")&&(console.log(e.target),console.log("Not submit"))}))}));let plek_manage_event={constructed:!1,flatpickr_band_options:{locale:"de",enableTime:!0,dateFormat:"Y-m-d H:i:S",altInput:!0,altFormat:"j.m H:i",onChange:function(selectedDates,dateStr,instance){plek_manage_event.set_button_time(instance)}},existing_vob_data:{},is_edit_event:!1,__construct(){!0!==this.constructed?(this.constructed=!0,this.add_event_listeners(),ajaxPreloader("bands"),ajaxPreloader("venues"),ajaxPreloader("organizers"),jQuery(document).ready((function(){plek_manage_event.prepare_validator_fields(),plekvalidator.monitor_fields(),flatpickr("#event_start_date",flatpickr_options),flatpickr("#event_end_date",flatpickr_options),plek_manage_event.add_vob_to_current_selection("bands"),plek_manage_event.add_vob_to_current_selection("venue"),plek_manage_event.add_vob_to_current_selection("organizers")})),empty(plekevent.get_field_value("event_id"))||(this.is_edit_event=!0),jQuery(".event-date-postponed-check-container").hide()):console.log("Manage Event already constructed")},set_button_time(flatpickr_instance){let date=jQuery(flatpickr_instance.element).next().val();if(0===date.length)return!1;plekevent.event_is_single_day()||void 0!==plek_manage_event.flatpickr_band_options.enable[0]&&plek_manage_event.flatpickr_band_options.enable[0].from===plek_manage_event.flatpickr_band_options.enable[0].to&&(date=void 0!==date.split(" ")[1]?date.split(" ")[1]:date),jQuery(flatpickr_instance.element).parent().find(".time-label").text(date)},add_event_listeners(){console.log("Add event eventlistener"),jQuery(".overlay_content .plek-form").on("click",".plek-button",(function(e){let button_id=e.currentTarget.id;e.preventDefault(),plek_manage_event.send_vob_form(button_id)})),jQuery(".plek-form").on("click",".plek-button-cancel",(function(e){let button_id=e.currentTarget.id;e.preventDefault(),plek_manage_event.vob_form_cancel(button_id)})),jQuery("#is_multiday").click((function(){jQuery(this).is(":checked")?show_end_date():hide_end_date(),plekevent.set_band_time_flatpickr(),console.log("Updated band time multiday btn")})),jQuery("#is_multiday").is(":checked")&&show_end_date(),jQuery("#no_band").click((function(){jQuery(this).is(":checked")?(disable_band_input(),jQuery("#event-band-selection").hide()):(jQuery("#event-band-selection").show(),enable_band_input())})),jQuery("#event_start_date").change((function(){var start_date=jQuery("#event_start_date").val(),end_date=jQuery("#event_end_date").val(),end_options=flatpickr_options;let startDD,endDD;new Date(start_date)>new Date(end_date)&&jQuery("#event_end_date").val(""),end_options.minDate=start_date,flatpickr("#event_end_date",end_options),plek_manage_event.is_edit_event&&jQuery(".event-date-postponed-check-container").show()})),jQuery(".date-input-container input").change((function(){plekevent.set_band_time_flatpickr(),console.log("Updated band time")})),jQuery("#plek-submit-basic-event").click((function(event){event.preventDefault(),jQuery(this).prop("disabled",!0);var type=jQuery(this).data("type"),form="add_event_basic";if("new_event_next_page"!==type)window.plekevent.save_event(type,form);else{let url=jQuery(this).data("url");window.location=url}})),jQuery("#plek-submit-event-details").click((function(event){event.preventDefault(),jQuery(this).prop("disabled",!0);var type=jQuery(this).data("type"),form="add_event_details";window.plekevent.save_event(type,form)})),jQuery("#plek-submit-event-edit").click((function(event){event.preventDefault(),jQuery(this).prop("disabled",!0);var type=jQuery(this).data("type"),form="edit_event_form";window.plekevent.save_event(type,form)})),jQuery("#main").on("click","#plek-add-login-submit",(function(event){event.preventDefault(),jQuery(this).prop("disabled",!0);var type=jQuery(this).data("type");window.plekevent.save_event_login(type)})),jQuery("#plek-submit-event-edit-review").on("click",event=>{event.preventDefault(),jQuery(this).prop("disabled",!0),plekevent.save_review()}),jQuery(".plek-search-input").focus((function(element){plektemplate.hide_overlay(),plektemplate.show_overlay(this)})),jQuery(".plek-search-input").keyup((function(element){var input_length;0!==jQuery(this).val().length?pleksearch.fire_search(this):window.plektemplate.hide_overlay()})),jQuery(".event-organizer-proposal-item").click((function(element){window.plekevent.add_item_to_selection(this)})),jQuery(".event-band-container").on("click","#no_band",(function(element){var checked=jQuery(this).is(":checked");plekvalidator.add_field("event_band","int",checked,"add_event_basic")})),jQuery("input").on("keyup",(function(){plekerror.clear_field_error(jQuery(this).attr("id"))})),jQuery("#main").on("click","#add_as_guest",(function(){plek_add_event_functions.show_guest_login()})),jQuery("#main").on("click","#add_login",(function(){plek_add_event_functions.show_login_form()})),jQuery(".plek-search-overlay").on("click",".add-new-vob-button",(function(e){plek_add_event_functions.show_vob_form(e.currentTarget.id)}))},send_vob_form(type=null){let default_submit_btn_text=jQuery("#"+type).text();var data;if(void 0===(data=jQuery("#"+type).serialize()))return console.log("Type not found: "+type),!1;let vob_form_name="";switch(type){case"band-form-submit":vob_form_name="band";break;case"venue-form-submit":vob_form_name="venue";break;case"organizer-form-submit":vob_form_name="organizer";break;default:return console.log("type not supported:"+type),!1}plek_main.activate_button_loader("#"+type,__("Save...","pleklang")),plek_main.remove_field_errors();let button=jQuery("#"+type),form=document.getElementById("plek-"+vob_form_name+"-form");var data=this.prepare_vob_data(form,type);if(!0!==plekvalidator.validate_form_data(data,"add_"+vob_form_name))return jQuery("#"+type).prop("disabled",!1),plekvalidator.display_errors("add_"+vob_form_name),plek_main.deactivate_button_loader(button,default_submit_btn_text),!1;jQuery.ajax({url:window.ajaxurl,type:"POST",cache:!1,processData:!1,contentType:!1,data:data,success:function success(data){let text="",errors;if(!0===plek_main.show_field_errors(data,form))console.log("Contains Errors"),text="Das Formular enthÃ¤lt Fehler, bitte korrigieren";else{text=plek_main.get_first_success_from_ajax_request(data);let return_obj=plek_main.get_ajax_success_object(data);if(void 0===return_obj)plekerror.display_error(null,__("Oops, something went wrong.... sorry!","pleklang"),__("Invalid Response","pleklang"));else{let preloader_data="string"==typeof return_obj[2]?JSON.parse(return_obj[2]):{};void 0!==return_obj[1]&&void 0!==return_obj[2]&&"undefined"!=typeof plekevent&&void 0!==preloader_data[return_obj[1]]&&(plekevent.add_new_vob_to_selection(type,return_obj[1],preloader_data),plek_main.clear_form_inputs("plek-"+vob_form_name+"-form"),plek_manage_event.vob_add_to_session(return_obj[1]))}}plek_main.deactivate_button_loader(button,text),jQuery("#"+type+" .plek-button-cancel").text(__("Back","pleklang")),setTimeout(()=>{jQuery("#"+type).text(default_submit_btn_text)},5e3)},error:function error(data){plek_main.deactivate_button_loader(button,__("Error loading data. ","pleklang"))}})},prepare_vob_data(form,type){if("object"!=typeof form)return!1;var data=new FormData(form);switch(type){case"band-form-submit":data.append("action","plek_band_actions"),data.append("do","save_band");var file_data=jQuery("#band-logo").prop("files")[0];data.append("band-description",tinymce.editors["band-description"].getContent()),data.append("band-logo-data",file_data),data.append("band-logo","666");break;case"venue-form-submit":data.append("action","plek_venue_actions"),data.append("do","save_venue");break;case"organizer-form-submit":data.append("action","plek_organizer_actions"),data.append("do","save_organizer")}return data},prepare_validator_fields(){var form="";jQuery("form").each((index,value)=>{if("plek-band-form"===(form=jQuery(value).attr("id"))&&(plekvalidator.add_field("band-id","int",!0,"add_band"),plekvalidator.add_field("band-name","text",!1,"add_band"),plekvalidator.add_field("band-description","text",!0,"add_band"),plekvalidator.add_field("band-logo-data","data",!0,"add_band"),plekvalidator.add_field("band-genre","int",!1,"add_band"),plekvalidator.add_field("band-origin","text",!1,"add_band"),plekvalidator.add_field("band-videos","text",!0,"add_band"),plekvalidator.add_field(["band-link-insta","band-link-fb","band-link-web"],"url",!0,"add_band"),plekvalidator.add_invalid_field_values("band-origin",["null"],"add_band"),plekvalidator.add_error_messages("band-origin","add_band",null,null,null,null,null,__("Please select a country","pleklang"))),"plek-organizer-form"===form&&(plekvalidator.add_field("organizer-id","int",!0,"add_organizer"),plekvalidator.add_field("organizer-name","text",!1,"add_organizer"),plekvalidator.add_field("organizer-email","email",!0,"add_organizer"),plekvalidator.add_field("organizer-phone","phone",!0,"add_organizer"),plekvalidator.add_field("organizer-web","url",!0,"add_organizer")),"plek-venue-form"===form&&(plekvalidator.add_field("venue-id","int",!0,"add_venue"),plekvalidator.add_field(["venue-name","venue-street","venue-city","venue-country"],"text",!1,"add_venue"),plekvalidator.add_field(["venue-province"],"text",!0,"add_venue"),plekvalidator.add_field("venue-zip","int",!1,"add_venue"),plekvalidator.add_field("venue-phone","phone",!0,"add_venue"),plekvalidator.add_field("venue-web","url",!0,"add_venue"),plekvalidator.add_invalid_field_values("venue-country",["null"],"add_venue"),plekvalidator.add_error_messages("venue-country","add_venue",null,null,null,null,null,__("Please select a country","pleklang"))),"edit_event_form"===form&&(plekvalidator.add_field("event_ticket_raffle","url",!0,form),plekvalidator.add_field("event_status","text",!1,form),plekvalidator.add_field("event_featured","bool",!0,form),plekvalidator.add_field("event_promote","bool",!0,form)),"add_event_basic"!==form&&"edit_event_form"!==form||(plekvalidator.add_field("event_name","text",!1,form),plekvalidator.add_field("event_start_date","date",!1,form),plekvalidator.add_field("event_band","int",!1,form),plekvalidator.add_field("event_venue","int",!1,form),plekvalidator.add_field("hp-password","honeypot",!0,form)),"add_event_details"!==form&&"edit_event_form"!==form||(plekvalidator.add_field("event_description","text",!0,form),plekvalidator.add_field("event_organizer","int",!0,form),plekvalidator.add_field("event_poster","file",!0,form),plekvalidator.add_field("event_fb_link","url",!0,form),plekvalidator.add_field("event_price_boxoffice","price",!0,form),plekvalidator.add_field("event_price_presale","price",!0,form),plekvalidator.add_field("event_currency","simpletext",!1,form),plekvalidator.add_field("event_price_link","url",!0,form),plekvalidator.add_field("event_id","int",!1,form),plekvalidator.add_error_messages("event_id",form,__("Missing Event ID","pleklang"))),"add_event_login"===form){let required_login=!1,allow_empty_login="none"===jQuery("#plek-event-member-login-form-container").css("display"),allow_empty_guest="none"===jQuery("#plek-event-guest-login-form-container").css("display");plekvalidator.add_field("user_login","text",allow_empty_login,form),plekvalidator.add_field("user_pass","password",allow_empty_login,form),plekvalidator.add_field("rememberme","text",!0,form),plekvalidator.add_field("guest_name","text",allow_empty_guest,form),plekvalidator.add_field("guest_email","email",allow_empty_guest,form),plekvalidator.add_field("event_id","int",!1,form),plekvalidator.add_error_messages("event_id",form,__("Missing Event ID","pleklang"))}}),console.log("Added validator fields")},vob_form_cancel(button_id){if(0===jQuery("#"+button_id).closest(".overlay_content").length)window.location=document.referrer;else{let overlay_id=jQuery("#"+button_id).closest(".overlay_content").parent().prop("id");overlay_id=overlay_id.replace("_overlay",""),plektemplate.hide_overlay(overlay_id)}},vob_add_to_session(vob_id){let existing=localStorage.getItem("plek_vob_added"),added="string"==typeof existing?existing+","+vob_id.toString():vob_id.toString();localStorage.setItem("plek_vob_added",added)},add_vob_to_current_selection(type){let jdata="object"==typeof plek_manage_event.existing_vob_data[type]?plek_manage_event.existing_vob_data[type]:{};for(const[vob_id,item]of Object.entries(jdata))switch(type){case"bands":let band_item=plektemplate.load_band_item_template(item);plekevent.add_item_to_selection(band_item);break;case"venue":let venue_item=plektemplate.load_venue_item_template(item);plekevent.add_item_to_selection(venue_item);break;case"organizers":let organizer_item=plektemplate.load_organizer_item_template(item);plekevent.add_item_to_selection(organizer_item)}"bands"===type&&jQuery(document).ready(()=>{})}};function ajaxPreloader(type){var datab=new FormData;datab.append("action","plek_ajax_event_form"),datab.append("type","get_"+type),jQuery.ajax({url:window.ajaxurl,data:datab,type:"POST",cache:!1,processData:!1,contentType:!1,success:function success(data){if(data.length<2)return toastr.error(__("Error loading data","pleklang")+": "+type,"Error"),!1;var jdata=JSON.parse(data);return console.log(type+"-Data loaded ("+Object.keys(jdata).length+")"),"bands"===type?void(window.bandPreloadedData=jdata):"venues"===type?void(window.venuePreloadedData=jdata):"organizers"===type&&void(window.organizerPreloadedData=jdata)},error:function error(data){return window.plekerror.display_info(__("Error loading data","pleklang")+": "+data,"Error"),!1}})}function show_end_date(){jQuery(".plek-multi-date").show()}function hide_end_date(){jQuery(".plek-multi-date").hide()}function disable_band_input(){jQuery("input#event_band").prop("disabled",!0),jQuery(".event-search-bar-container plek-button").addClass("disabled"),jQuery(".event-search-bar-container #event_band").addClass("disabled"),jQuery(".event-band-selection").hide()}function enable_band_input(){jQuery("input#event_band").prop("disabled",!1),jQuery(".event-search-bar-container plek-button").removeClass("disabled"),jQuery(".event-search-bar-container #event_band").removeClass("disabled"),jQuery(".event-band-selection").show()}let plek_add_event_functions={show_guest_login(){this.hide_login_containers(),jQuery("#plek-event-guest-login-form-container").show(200),jQuery("#submit-add-event-login-from").show(),jQuery("#add_as_guest").addClass("selected")},show_login_form(){this.hide_login_containers(),jQuery("#plek-event-member-login-form-container").show(200),jQuery("#submit-add-event-login-from").show(),jQuery("#add_login").addClass("selected")},hide_login_containers(){jQuery("#submit-add-event-login-from:not(.selected), #plek-event-member-login-form-container:not(.selected), #plek-event-guest-login-form-container:not(.selected)").hide(),jQuery("#add_login, #add_as_guest").removeClass("selected")},show_vob_form(type){plektemplate.hide_overlay(),plektemplate.show_overlay(type)},add_event_details_reminder(event_id,event_name,add_event_stage=null){let reminder=new Object,date=new Date;if(reminder.valid_till=date.getTime()+9e5,reminder.event_id=event_id,reminder.name=event_name,reminder.stage=add_event_stage,null===window.localStorage.getItem("plek_event_reminder")){let reminder_obj={};reminder_obj[event_id]=reminder,window.localStorage.setItem("plek_event_reminder",JSON.stringify(reminder_obj))}else{let existing_remember=window.localStorage.getItem("plek_event_reminder");try{let reminder_obj=JSON.parse(existing_remember);reminder_obj[event_id]=reminder,window.localStorage.setItem("plek_event_reminder",JSON.stringify(reminder_obj))}catch(error){console.log(error)}}},remove_event_details_reminder(event_id,prompt=!1){console.log("Event Reminder removed");let existing_remember=window.localStorage.getItem("plek_event_reminder");try{var reminder_obj=JSON.parse(existing_remember);jQuery.each(reminder_obj,(index,obj)=>{if(obj.event_id==event_id)if(prompt){let button_text=__("You are deleting this Notification permanently. You will probably not be able to Edit this Event afterwards.\nAre your sure?","pleklang");!0===confirm(button_text)&&delete reminder_obj[index]}else delete reminder_obj[index]})}catch(error){return console.log(error),!1}return empty(existing_remember)?(window.localStorage.removeItem("plek_event_reminder"),!0):(window.localStorage.setItem("plek_event_reminder",JSON.stringify(reminder_obj)),!0)},maybe_display_event_details_reminder(){if(plek_main.page_has_event_form()||plek_main.page_has_login_form())return!1;let reminder=window.localStorage.getItem("plek_event_reminder");if(null===reminder)return!1;try{let reminder_obj=JSON.parse(reminder),date=new Date;jQuery.each(reminder_obj,(index,obj)=>{if(date.getTime()>obj.valid_till)return void plek_add_event_functions.remove_event_details_reminder(obj.event_id);let url=empty(obj.stage)?plek_main.event_edit_page_id:plek_main.event_add_page_id,link_text=empty(obj.stage)?__("Edit Event","pleklang"):__("Continue with adding the Event","pleklang"),link_name=empty(obj.name)?link_text:link_text+": "+obj.name,link=empty(obj.stage)?'<a class="fix_event_link" data-event_id= "'+obj.event_id+'" href="'+url+"?edit="+obj.event_id+'">'+link_name+"</a>":'<a class="fix_event_link" data-event_id= "'+obj.event_id+'" href="'+url+"?event_id="+obj.event_id+"&stage="+obj.stage+'">'+link_name+"</a>";plekerror.set_toastr(0,!0,"toast-bottom-full-width",()=>{plek_add_event_functions.remove_event_details_reminder(obj.event_id,!0)}),plekerror.display_info(__("Eventmanager Tipp","pleklang"),__("The Event you added misses some details. Please add them here:","pleklang")+"<br/>"+link),plekerror.reset_toastr()})}catch(error){return console.log(error),!1}}};plek_add_event_functions.hide_login_containers();