var plekevent={existing_event:null,construct(){plekevent.add_events_listener()},add_events_listener(){jQuery("#event_start_date").on("change",(function(){window.plekevent.check_existing_event()}))},check_existing_event(){if(""!==this.get_field_value("event_start_date")&&jQuery("#event-band-selection .item").length>0){var datab=new FormData;datab.append("action","plek_ajax_event_form"),datab.append("type","check_event_duplicate"),datab.append("start_date",this.get_field_value("event_start_date")),datab.append("band_ids",JSON.stringify(this.get_field_value("bands"))),console.log(datab),jQuery.ajax({url:window.ajaxurl,data:datab,type:"POST",cache:!1,processData:!1,contentType:!1,success:function success(data){var jdata=JSON.parse(data);return""!==jdata.error?(window.plekerror.display_info("Achtung",jdata.error),plekevent.existing_event=!0,console.log("Event Existiert bereits"),!0):(plekevent.existing_event=!1,console.log("Event existiert nicht"),!1)},error:function error(data){return window.plekerror.display_info(window.pleklang.loaderror+": "+data,"Error"),!1}})}return null},add_item_to_selection(element){var item_for=jQuery(element).data("for"),type=jQuery(element).data("type"),item_id=jQuery(element).data("id"),html,data={id:item_id,name:jQuery(element).html()};0===jQuery(`.plek-select-item[data-id='${item_id}']`).length&&jQuery("#"+item_for).append(plektemplate.get_item_to_add(data)),plektemplate.hide_overlay(),jQuery("#"+type).val(""),plekevent.add_remove_item_eventlistener(),"event_band"===type&&(window.plekevent.check_existing_event(),window.plekevent.generate_title())},add_remove_item_eventlistener(){jQuery(".remove-item").click((function(){jQuery(this).parent().parent().remove()}))},remove_all_items(selector){jQuery("#"+selector+" .item").remove()},save_event(type){console.log("save"+type);var datab=this.prepare_data(type);if(!0!==plekvalidator.validate_form_data(datab))return jQuery("#plek-submit").prop("disabled",!1),plekvalidator.display_errors(),!1;jQuery.ajax({url:window.ajaxurl,data:datab,type:"POST",cache:!1,processData:!1,contentType:!1,success:function success(data){jQuery("#plek-submit").prop("disabled",!1);var jdata=JSON.parse(data);return""!==jdata.error?(window.plekerror.display_info("Achtung",jdata.error),this.existing_event=!0,console.log("Event Existiert beriets"),!0):(this.existing_event=!1,console.log("Event existiert nicht"),!1)},error:function error(data){return window.plekerror.display_info(window.pleklang.loaderror+": "+data,"Error"),!1}})},prepare_data(type){var datab=new FormData;return datab.append("action","plek_ajax_event_form"),datab.append("type",type),"save_basic_event"===type&&(datab.append("event_name",this.get_field_value("event_name")),datab.append("event_start_date",this.get_field_value("event_start_date")),!0===jQuery("#is_multiday").is(":checked")&&(datab.append("event_end_date",this.get_field_value("event_end_date")),plekvalidator.add_field("event_end_date","date")),!0===jQuery("#no_band").is(":checked")?(datab.append("no_bands_known","true"),plekvalidator.add_field("event_band","int",!0)):plekvalidator.add_field("event_band","int"),datab.append("event_band",this.get_field_value("bands")),datab.append("event_venue",this.get_field_value("venue")),plekvalidator.add_field("event_name","text"),plekvalidator.add_field("event_start_date","date"),plekvalidator.add_field("event_venue","int")),datab},get_field_value(name){switch(name){case"bands":return this.get_selector_ids("event-band-selection");case"venue":return this.get_selector_ids("event-venue-selection");default:return jQuery("#"+name).val()}},get_selector_ids(selector_id){var ids=[],items=jQuery("#"+selector_id).find(".plek-select-item");return jQuery.each(items,(function(key,val){var id=jQuery(val).data("id");ids.push(id)})),0===Object.keys(ids).length?"":JSON.stringify(ids)},generate_title(){let selected_bands=jQuery("#event-band-selection .item");var title_input=jQuery("#event_name"),band_order=[];jQuery.each(selected_bands,(function(index){let id=jQuery(this).data("id"),band_name=bandPreloadedData[id].name,band_score=parseInt(bandPreloadedData[id].score);band_order.push([band_score,band_name])})),band_order.sort((function(a,b){var a0=a[0],b0=b[0];return a0==b0?0:a0<b0?1:-1}));var total_items=band_order.length,event_name_text="";jQuery.each(band_order,(function(index){0!==index?event_name_text+=index+1!==total_items?", "+this[1]:" & "+this[1]:event_name_text=this[1]})),jQuery(title_input).val(event_name_text)}};plekevent.construct();