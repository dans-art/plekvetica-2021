"use strict";function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}function _arrayWithoutHoles(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}var evaluation=function evaluation(charX,charY,costs){return charX==charY?costs.match:costs.mismatch},createMatrix=function createMatrix(length1,length2){return _toConsumableArray(new Array(length1)).map((function(a){return _toConsumableArray(new Array(length2)).map((function(b){return 1}))}))},initXAxis=function initXAxis(fields,value){return fields.map((function(field,i){return i?field:field.map((function(d){return value}))}))},initYAxis=function initYAxis(fields,value){return fields.map((function(xAxis){return xAxis.map((function(yAxis,axisIndex){return 0===axisIndex?value:0}))}))},tracebackDirectionHash=["d","u","l"],F=function F(i,j,ma,costs){var tracebackPoint="",matches=[+ma.matches[j-1][i-1]+evaluation(ma.sequence[i-1],ma.pattern[j-1],costs),+ma.matches[j-1][i]+costs.gap,+ma.matches[j][i-1]+costs.gap],bestMatch=Math.max.apply(Math,matches);return matches.filter((function(e){return bestMatch===e})).length>1&&matches[0]===bestMatch&&bestMatch>0?tracebackPoint=tracebackDirectionHash[0]:1==matches.filter((function(e){return bestMatch===e})).length&&bestMatch>0?tracebackPoint=tracebackDirectionHash[matches.indexOf(bestMatch)]:bestMatch<=0&&(tracebackPoint=0,bestMatch=0),[bestMatch,tracebackPoint]},matrix=function matrix(seq,pattern){return{sequence:seq,pattern:pattern,matches:createMatrix(pattern.length+1,seq.length+1),traceback:createMatrix(pattern.length+1,seq.length+1),peak:{cell:{},value:0},initalizeMatrix:function initalizeMatrix(){this.matches=initXAxis(initYAxis(this.matches,0),0),this.traceback=initXAxis(initYAxis(this.matches,0),0),this.traceback[0][0]=0},computeScore:function computeScore(costs){var _this=this,tracebackMatrix=this.traceback;this.traceback=tracebackMatrix.map((function(row,yIndex){return 0===yIndex?row:row.map((function(element,xIndex){if(0===xIndex)return element;var field=F(xIndex,yIndex,_this,costs);return _this.peak.value<=field[0]&&(_this.peak.cell={x:+xIndex,y:+yIndex},_this.peak.value=field[0]),_this.matches[yIndex][xIndex]=field[0],field[1]}))}))},trace:[],getTrace:function getTrace(){var it=0;for(var activeCell=jQuery.extend({},this.peak.cell);0!==this.traceback[activeCell.y][activeCell.x]&&!(it>20);)it+=1,"d"===this.traceback[activeCell.y][activeCell.x]?(this.trace.push({seqChar:this.sequence[activeCell.x-1],patChar:this.pattern[activeCell.y-1],seqIndex:activeCell.x,patIndex:activeCell.y}),activeCell.x-=1,activeCell.y-=1):"u"===this.traceback[activeCell.y][activeCell.x]?(this.trace.push({seqChar:"-",patChar:this.pattern[activeCell.y-1],seqIndex:activeCell.x,patIndex:activeCell.y}),activeCell.x-=1):"l"===this.traceback[activeCell.y][activeCell.x]&&(this.trace.push({seqChar:this.sequence[activeCell.x-1],patChar:"-",seqIndex:activeCell.x,patIndex:activeCell.y}),activeCell.y-=1)}}},smith_waterman=function smith_waterman(text,pattern,costs){var M=matrix(text,pattern);return M.initalizeMatrix(),M.computeScore(costs),M.getTrace(),M};