var pleksearch={current_type:null,threshold:40,last_search_result:null,fire_search(element){var search_field_id=jQuery(element).attr("id"),type=jQuery("#"+search_field_id).attr("name"),result_con=jQuery("#"+type+"_overlay");if(this.set_type_settings(type),0!=result_con.length){result_con.html("<div class='item'><span class='plek_loading'></span>&nbsp;Lade Ergebnise....</div>");var tout=window.plekTimeout;window.clearTimeout(tout),window.plekTimeout=window.setTimeout((function(){window.pleksearch.search(search_field_id).then((function(findings){result_con.html(pleksearch.display_results(findings)),window.pleksearch.add_item_Eventlistener(),plektemplate.show_overlay(search_field_id)}))}),500)}else plekerror.display_error("No Result Container found.")},set_type_settings(type){switch(window.pleksearch.current_type=type,type){case"event_venue":case"event_band":case"event_organizer":window.pleksearch.threshold=40}},display_results(result_object){var result="",total=Object.keys(result_object).length,type=window.pleksearch.current_type;header=plektemplate.load_search_overlay_header(total),pleksearch.last_search_result=result_object;let sorted=pleksearch.sort_results(result_object);jQuery.each(sorted,(function(key,value){switch(type){case"event_band":result=plektemplate.load_band_item_template(value.data,value.perc)+result;break;case"event_venue":result=plektemplate.load_venue_item_template(value.data)+result;break;case"event_organizer":console.log(plektemplate.load_organizer_item_template(value.data)),result=plektemplate.load_organizer_item_template(value.data)+result}}));var add_button=!1;return"event_band"===type&&(add_button="<span><button type='button' id='add-new-band' class='plek-button add-new-vob-button'>"+__("Add new Band","plekvetica")+"</button></span>"),"event_venue"===type&&(add_button="<span><button type='button' id='add-new-venue' class='plek-button add-new-vob-button'>"+__("Add new Venue","plekvetica")+"</button></span>"),"event_organizer"===type&&(add_button="<span><button type='button' id='add-new-organizer' class='plek-button add-new-vob-button'>"+__("Add new Organizer","plekvetica")+"</button></span>"),!1!==add_button&&(header=plektemplate.load_search_overlay_header(total,add_button)),header+result},add_item_Eventlistener(){jQuery(".plek-add-item").click((function(element){element.preventDefault(),window.plekevent.add_item_to_selection(this)}))},async search(element){var search_for,search_for_prep=jQuery("#"+element).val().toLowerCase().replace(/[^a-z 0-9]/,""),type=window.pleksearch.current_type;return pleksearch.get_preloaded_data(type).then((function(data){var results={};return jQuery.each(data,(function(key,value){var compare_prep=value.name.toLowerCase().replace(/[^a-z 0-9]/,"");try{var sm_compare=smith_waterman(search_for_prep,compare_prep,{match:10,mismatch:-1,gap:-1})}catch(error){return new Promise(resolve=>{resolve(!1)})}let input_length=search_for_prep.length,search_length=sm_compare.pattern.length,threshold=window.pleksearch.threshold;input_length/search_length*100<20&&(threshold/=2);var exact_hit=pleksearch.is_exact_hit(search_for_prep,compare_prep);if(sm_compare.peak.value>=threshold||!0===exact_hit){var item={};item.type=type,item.data=value,item.class=!0===exact_hit?"exact-hit":"",item.perc=!0===exact_hit?150:sm_compare.peak.value,results[value.id]=item}})),new Promise(resolve=>{resolve(pleksearch.transport_data(results))})}))},transport_data:data=>data,sort_results(data){jQuery.each(data,(function(key,value){let sliced_key=("0000000"+key).slice(-7);data[value.perc+sliced_key]=value,delete data[key]}));let sorted_arr=Object.keys(data).sort(),sorted_obj=new Object;return jQuery.each(sorted_arr,(function(index,key){let sorted_value=data[key];sorted_obj[key]=sorted_value})),sorted_obj},is_exact_hit(needle,haystack){var exact_hit;return 0===haystack.search(needle)&&haystack.length===needle.length||needle===haystack},async get_preloaded_data(type){return new Promise(resolve=>{var data;resolve(this.get_preloaded_object(type))})},get_preloaded_object(type){if("event_band"===type)var data=window.bandPreloadedData;else if("event_venue"===type)var data=window.venuePreloadedData;else if("event_organizer"===type)var data=window.organizerPreloadedData;return data}};